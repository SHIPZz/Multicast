# Архитектура проекта

## 1. Инициализация и управление состояниями

### 1.1. BootstrapInstaller

`BootstrapInstaller` отвечает за связывание сервисов. Используется нестандартный подход, при котором метод `Initialize` привязывается к инсталлеру, позволяя сразу перейти к его выполнению, а затем — к состоянию `BootstrapState`.

### 1.2. BootstrapState

`BootstrapState` через `WindowService` привязывает окна, загружает данные из Addressables с помощью соответствующего сервиса, проверяет наличие интернет-соединения. В случае отсутствия соединения выполняются повторные проверки каждые 3 секунды до его восстановления. Далее инициализируется Unity Remote Config, загружаются сохраненные данные и настраивается система сохранения при потере фокуса. После завершения этих процессов происходит переход в `LoadingMenuState`.

### 1.3. LoadingMenuState

`LoadingMenuState` с помощью `SceneLoader` загружает сцену меню из Addressables и после завершения загрузки переходит в `MenuState`.

### 1.4. MenuState

В `MenuState` закрываются все окна и открывается окно меню.

### 1.5. CleanupBeforeLoadingGameState

`CleanupBeforeLoadingGameState` используется для очистки сервисов, связанных с игрой, после чего происходит переход в `LoadGameState`.

### 1.6. LoadGameState

`LoadGameState` проверяет интернет-соединение, закрывает все окна, загружает игровую сцену и переходит в `GameState`.

### 1.7. GameState

В `GameState` происходит инициализация игры, включая загрузку текущего сохраненного уровня, инициализацию слов для поиска, кластеров, сервисов подсказок, управления кластерами и ячейками.

## 2. Управление кластерами и ячейками

Функциональность управления кластерами и ячейками разделена между следующими сервисами:

- `ClusterService`
- `ClusterRepository`
- `ClusterPlacement`
- `WordSlotService`
- `WordSlotRepository`

## 3. Работа с ресурсами

- `StaticDataService` и `AssetProvider` отвечают за загрузку префабов из Addressables.

## 4. Система сохранений

- `PlayerPrefsSaveSystem` обеспечивает сохранение данных. Все наблюдатели за прогрессом реализуют интерфейс `IProgressWatcher` с методами `Load(ProgressData)` и `Save(ProgressData)`, что позволяет сохранять и восстанавливать текущий прогресс.

## 5. Система подсказок

- `HintService` и `HintConfig` реализуют простую систему подсказок для пользователя.

## 6. Управление звуками

- `SoundPlayerView`, `SoundConfig` и `SoundService` обеспечивают работу со звуками, которые также хранятся в Addressables.

## 7. Управление окнами

- `WindowService` реализует паттерн MVC, позволяя связывать контроллеры и представления, а также контроллеры, представления и сервисы вместо моделей. Контроллер управляет представлением и передает ему данные.

## 8. Автоматизация сборки и развертывания

После сборки проекта осуществляется автоматическая загрузка Addressables и билдов на Yandex Object Storage с использованием Amazon S3 SDK.

## 9. Оптимизация производительности

### 9.1. Оптимизация кода

Минимизированы вызовы сборщика мусора (GC) путем предварительного выделения памяти для строк и коллекций в начале уровня. Для часто используемых коллекций применяются пулы (`DictionaryPool`, `ListPool`), а также задаются начальные емкости для каждой коллекции.

### 9.2. Оптимизация UI

Отключены `Raycast Target` и `Rich Text` у компонентов TextMeshPro, где это не требуется, а также `Raycast Target` у ненужных изображений, что улучшает производительность пользовательского интерфейса.
